<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mood</title>
	<link rel="stylesheet" href="/source/css/bootstrap.min.css">
	<link rel="stylesheet" href="/source/css/index.css">
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<ul class="nav navbar-nav navbar-right">
				<li><a data-bind="click: sign_out" href="javaScript:void(0);">Sign out <span class="sr-only"></span></a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="javaScript:void(0);">User</a></li>
			</ul>
		</div>
	</nav>

	<div>
		<div id="map"></div>
		<div style="display: none;">
			<div id="form">
				<table>
					<tr>
						<td>Name:</td>
						<td><input type='text' id='name'/></td>
					</tr>
					<tr>
						<td>Address:</td>
						<td><input type='text' id='address'/></td>
					</tr>
					<tr>
						<td>Type:</td>
						<td>
							<select id='type'> +
								<option value='bar' SELECTED>bar</option>
								<option value='restaurant'>restaurant</option>
							</select>
						</td>
					</tr>
					<tr>
						<td></td>
						<td><input type='button' value='Save' onclick='saveData()'/></td>
					</tr>
				</table>
			</div>
			<div id="message">Location saved</div>
		</div>
	</div>
    <script>
	var map;
	var marker;
	var infowindow;
	var messagewindow;

	function initMap() {
		var california = {lat: 37.4419, lng: -122.1419};
		map = new google.maps.Map(document.getElementById('map'), {
			center: california,
			zoom: 13
		});

		infowindow = new google.maps.InfoWindow({
			content: document.getElementById('form')
		});

		messagewindow = new google.maps.InfoWindow({
			content: document.getElementById('message')
		});

		google.maps.event.addListener(map, 'click', function(event) {
			if(marker) {
				marker.setPosition(event.latLng);
			}
			else {
				marker = new google.maps.Marker({
					position: event.latLng,
					map: map,
					draggable: true
				});
			}

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.open(map, marker);
			});
		});
	}

	function saveData() {
		var name = escape(document.getElementById('name').value);
		var address = escape(document.getElementById('address').value);
		var type = document.getElementById('type').value;
		var latlng = marker.getPosition();
		var url = 'phpsqlinfo_addrow.php?name=' + name + '&address=' + address +
		'&type=' + type + '&lat=' + latlng.lat() + '&lng=' + latlng.lng();

		infowindow.close();
		messagewindow.open(map, marker);
	}
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBs2ci0iP6wwrxjQyL0i2tFV-ldljerHso&callback=initMap"></script>

	<script type='text/javascript' src='/source/js/lib/knockout-3.4.1.js'></script>
	<script type='text/javascript' src='/source/js/lib/jquery-2.1.3.min.js'></script>
	<script type='text/javascript' src='/source/js/lib/bootstrap.min.js'></script>
	<script type='text/javascript' src='/source/js/common.js'></script>
	<script type='text/javascript' src='/source/js/app/userViewModel.js'></script>
</body>
</html